{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card mb-4">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">
                        <i class="fas fa-virus me-2"></i>Malware-Simulator
                    </h2>
                    <span class="badge bg-danger">Nur für Bildungszwecke</span>
                </div>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <div class="d-flex">
                        <div>
                            <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                        </div>
                        <div>
                            <strong>Bildungszweck:</strong> Dieses Tool simuliert ausschließlich theoretisch, wie Malware funktionieren könnte. 
                            Es werden keine tatsächlichen Schadprogramme erstellt oder ausgeführt. Diese Simulation dient dem Verständnis von 
                            Angriffsvektoren und Schutzmechanismen gegen Malware im Rahmen der universitären Bildung.
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-lg-4">
                        <div class="card border-dark">
                            <div class="card-header bg-dark text-white">
                                <h4 class="mb-0"><i class="fas fa-cog me-2"></i>Simulations-Parameter</h4>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('malware_simulator') }}">
                                    {{ form.hidden_tag() }}
                                    
                                    <div class="mb-3">
                                        <label for="target_system" class="form-label">{{ form.target_system.label }}</label>
                                        {{ form.target_system(class="form-control", placeholder="z.B. Windows 10 oder Ubuntu Server") }}
                                        <small class="form-text text-muted">System, für das die Simulation durchgeführt werden soll.</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="malware_type" class="form-label">{{ form.malware_type.label }}</label>
                                        {{ form.malware_type(class="form-select") }}
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="propagation" class="form-label">{{ form.propagation.label }}</label>
                                        {{ form.propagation(class="form-select") }}
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        {{ form.simulation_only(class="form-check-input", disabled=True) }}
                                        <label class="form-check-label" for="simulation_only">{{ form.simulation_only.label }}</label>
                                        <small class="form-text text-muted d-block">Diese Option ist für die Sicherheit immer aktiviert.</small>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        {{ form.submit(class="btn btn-danger") }}
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card border-dark mt-3">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Malware-Typen</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item bg-dark text-light border-secondary">
                                        <h6 class="mb-1"><i class="fas fa-lock me-2"></i>Ransomware</h6>
                                        <p class="mb-0 small">Verschlüsselt Dateien und fordert Lösegeld für die Entschlüsselung.</p>
                                    </div>
                                    <div class="list-group-item bg-dark text-light border-secondary">
                                        <h6 class="mb-1"><i class="fas fa-user-secret me-2"></i>Trojan</h6>
                                        <p class="mb-0 small">Tarnt sich als nützliche Software, führt aber heimlich schädliche Funktionen aus.</p>
                                    </div>
                                    <div class="list-group-item bg-dark text-light border-secondary">
                                        <h6 class="mb-1"><i class="fas fa-bug me-2"></i>Virus</h6>
                                        <p class="mb-0 small">Infiziert Dateien und verbreitet sich, wenn diese ausgeführt werden.</p>
                                    </div>
                                    <div class="list-group-item bg-dark text-light border-secondary">
                                        <h6 class="mb-1"><i class="fas fa-network-wired me-2"></i>Worm</h6>
                                        <p class="mb-0 small">Verbreitet sich selbstständig über Netzwerke ohne Benutzerinteraktion.</p>
                                    </div>
                                    <div class="list-group-item bg-dark text-light border-secondary">
                                        <h6 class="mb-1"><i class="fas fa-ghost me-2"></i>Rootkit</h6>
                                        <p class="mb-0 small">Versteckt sich tief im System und manipuliert Betriebssystemfunktionen.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        {% if result %}
                        <div class="card border-dark">
                            <div class="card-header bg-dark text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Simulationsergebnisse</h4>
                                    <span class="text-muted small">{{ result.timestamp }}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="sim-overview mb-4">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-laptop"></i></div>
                                                <div>
                                                    <div class="text-muted small">Zielsystem</div>
                                                    <div class="fw-bold">{{ result.target_system }}</div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-virus"></i></div>
                                                <div>
                                                    <div class="text-muted small">Malware-Typ</div>
                                                    <div class="fw-bold">{{ result.malware_type }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-exchange-alt"></i></div>
                                                <div>
                                                    <div class="text-muted small">Ausbreitungsmethode</div>
                                                    <div class="fw-bold">{{ result.propagation }}</div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-clock"></i></div>
                                                <div>
                                                    <div class="text-muted small">Simulationszeit</div>
                                                    <div class="fw-bold">{{ "%.2f"|format(result.simulation_time) }} s</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Simulation Stages -->
                                <div class="card border-dark mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Simulierte Malware-Phasen</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="list-group list-group-flush">
                                            {% for stage in result.stages %}
                                            <div class="list-group-item bg-dark border-secondary">
                                                <h6 class="mb-2 text-primary">{{ stage.name }}</h6>
                                                <ul class="mb-0 small">
                                                    {% for action in stage.actions %}
                                                    <li>{{ action }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Terminal Output -->
                                <div class="terminal-output-sim">
                                    <div class="terminal-header">
                                        <i class="fas fa-terminal me-2"></i> Simulierte Malware-Aktivität
                                    </div>
                                    <div class="terminal-content">
                                        <div class="line"><span class="time">[00:00:01]</span> <span class="text-warning">Initializing {{ result.malware_type }} module...</span></div>
                                        <div class="line"><span class="time">[00:00:02]</span> <span class="text-success">System information: {{ result.target_system }}</span></div>
                                        <div class="line"><span class="time">[00:00:03]</span> <span class="text-primary">Checking system vulnerabilities...</span></div>
                                        <div class="line"><span class="time">[00:00:04]</span> <span class="text-danger">Simulating {{ result.malware_type }} behavior - NO ACTUAL ACTIONS PERFORMED</span></div>
                                        <div class="line"><span class="time">[00:00:05]</span> <span class="text-warning">Propagation method: {{ result.propagation }}</span></div>
                                        <div class="line"><span class="time">[00:00:06]</span> <span class="text-primary">Simulating stage 1: {{ result.stages[0].name }}</span></div>
                                        <div class="line"><span class="time">[00:00:08]</span> <span class="text-primary">Simulating stage 2: {{ result.stages[1].name }}</span></div>
                                        <div class="line"><span class="time">[00:00:10]</span> <span class="text-primary">Simulating stage 3: {{ result.stages[2].name }}</span></div>
                                        <div class="line"><span class="time">[00:00:12]</span> <span class="text-primary">Simulating stage 4: {{ result.stages[3].name }}</span></div>
                                        <div class="line"><span class="time">[00:00:13]</span> <span class="text-success">Simulation complete</span></div>
                                        <div class="line"><span class="time">[00:00:14]</span> <span class="text-warning">NOTE: This is purely a simulation. No actual malware was created or executed.</span></div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-warning mt-4 mb-0">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    <strong>Wichtiger Hinweis:</strong> Diese Simulation dient ausschließlich zu Bildungszwecken und
                                    verdeutlicht, wie Malware theoretisch funktionieren könnte. Das Wissen über Angriffsmethoden ist
                                    grundlegend für die Entwicklung effektiver Schutzmaßnahmen.
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="card border-dark h-100">
                            <div class="card-header bg-dark text-white">
                                <h4 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Über Malware-Simulationen</h4>
                            </div>
                            <div class="card-body">
                                <h5>Was simuliert dieses Tool?</h5>
                                <p>
                                    Der Malware-Simulator zeigt zu Bildungszwecken, wie verschiedene Arten von Schadsoftware 
                                    theoretisch funktionieren könnten. Die Simulation veranschaulicht Angriffsmethoden, Verbreitungswege 
                                    und typische Verhaltensweisen von Malware, ohne tatsächlich schädliche Aktivitäten durchzuführen.
                                </p>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-biohazard me-2"></i>Infektionsmethoden
                                            </div>
                                            <div class="feature-card-content">
                                                Die verschiedenen Wege, wie Malware auf ein System gelangen kann: E-Mail-Anhänge, 
                                                infizierte Websites, Software-Downloads oder USB-Sticks.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-eye-slash me-2"></i>Tarnungstechniken
                                            </div>
                                            <div class="feature-card-content">
                                                Methoden, mit denen sich Malware vor Entdeckung schützt: Code-Verschleierung, 
                                                Anti-VM-Techniken, Prozessinjektion oder Rootkit-Technologie.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-bomb me-2"></i>Schadensroutinen
                                            </div>
                                            <div class="feature-card-content">
                                                Die eigentlichen schädlichen Aktionen: Dateiverschlüsselung, Datendiebstahl, 
                                                Systemmanipulation oder Backdoor-Installation.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-broadcast-tower me-2"></i>Command & Control
                                            </div>
                                            <div class="feature-card-content">
                                                Kommunikation mit externen Servern, die von Angreifern zur Steuerung der Malware 
                                                genutzt werden können.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4 border-danger bg-dark">
                                    <div class="card-header bg-danger text-white">
                                        <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Schutzmaßnahmen</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="mb-0">
                                            <li>Regelmäßige Software-Updates und Patches</li>
                                            <li>Aktuelle Antiviren-Software und Firewall</li>
                                            <li>Vorsicht bei E-Mails und Downloads aus unbekannten Quellen</li>
                                            <li>Regelmäßige Datensicherungen</li>
                                            <li>Benutzerrechtekontrolle und Prinzip der geringsten Rechte</li>
                                            <li>Schulung und Sensibilisierung von Benutzern</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Malware type change handler
    const malwareTypeSelect = document.getElementById('malware_type');
    const propagationSelect = document.getElementById('propagation');
    
    if (malwareTypeSelect && propagationSelect) {
        malwareTypeSelect.addEventListener('change', function() {
            // Suggest appropriate propagation methods based on malware type
            if (this.value === 'worm') {
                propagationSelect.value = 'network';
            } else if (this.value === 'trojan') {
                propagationSelect.value = 'download';
            } else if (this.value === 'ransomware') {
                propagationSelect.value = 'email';
            }
        });
    }
});
</script>
<style>
.terminal-output-sim {
    border: 1px solid #333;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.terminal-header {
    background-color: #0c0c0c;
    color: var(--hacker-primary);
    padding: 0.5rem;
    font-weight: bold;
    border-bottom: 1px solid #333;
}

.terminal-content {
    background-color: #0c0c0c;
    padding: 0.5rem;
    font-family: var(--mono-font);
    font-size: 0.8rem;
    height: 200px;
    overflow-y: auto;
}

.terminal-content .line {
    margin-bottom: 0.25rem;
    line-height: 1.4;
    display: flex;
}

.terminal-content .time {
    color: #888;
    margin-right: 0.5rem;
    min-width: 90px;
}

.feature-card {
    border: 1px solid #333;
    border-radius: 4px;
    overflow: hidden;
    height: 100%;
}

.feature-card-title {
    background-color: #0c0c0c;
    color: var(--hacker-primary);
    padding: 0.5rem;
    font-weight: bold;
}

.feature-card-content {
    background-color: #1a1a1a;
    padding: 0.75rem;
}

.list-group-item {
    background-color: #1a1a1a;
}
</style>
{% endblock %}