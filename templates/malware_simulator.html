{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card mb-4">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">
                        <i class="fas fa-virus me-2"></i>Malware Behavior Simulator
                    </h2>
                    <div class="d-flex align-items-center">
                        <div class="status-indicator status-danger me-2"></div>
                        <span class="badge bg-danger terminal-badge">High-Security Lab</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="alert alert-danger terminal-tip">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warnung:</strong> Dieses Tool simuliert lediglich das Verhalten verschiedener Malware-Typen zu Bildungszwecken. Es werden keine tatsächlichen schädlichen Aktionen durchgeführt. Die Verwendung echter Malware ist illegal und ethisch nicht vertretbar.
                </div>
                
                <form method="POST" action="{{ url_for('malware_simulator') }}" id="malwareSimForm">
                    {{ form.hidden_tag() }}
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card border-dark h-100">
                                <div class="card-header bg-dark text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-cog me-2"></i>Simulationseinstellungen
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="target_system" class="form-label">{{ form.target_system.label }}</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-dark text-light"><i class="fas fa-laptop"></i></span>
                                            {{ form.target_system(class="form-control terminal-input", placeholder="z.B. Windows 10, Linux Server, etc.") }}
                                        </div>
                                        {% if form.target_system.errors %}
                                            <div class="text-danger">
                                                {% for error in form.target_system.errors %}
                                                    <small>{{ error }}</small>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="malware_type" class="form-label">{{ form.malware_type.label }}</label>
                                        {{ form.malware_type(class="form-select terminal-input", id="malwareTypeSelect") }}
                                        {% if form.malware_type.errors %}
                                            <div class="text-danger">
                                                {% for error in form.malware_type.errors %}
                                                    <small>{{ error }}</small>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="propagation" class="form-label">{{ form.propagation.label }}</label>
                                        {{ form.propagation(class="form-select terminal-input") }}
                                        {% if form.propagation.errors %}
                                            <div class="text-danger">
                                                {% for error in form.propagation.errors %}
                                                    <small>{{ error }}</small>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-check form-switch mb-3">
                                        {{ form.simulation_only(class="form-check-input", checked=True, disabled=True) }}
                                        <label class="form-check-label" for="simulation_only">
                                            {{ form.simulation_only.label }} <span class="text-muted small">(Immer aktiviert für Sicherheit)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card border-dark h-100">
                                <div class="card-header bg-dark text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-info-circle me-2"></i>Malware-Informationen
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div id="malwareInfo" class="mb-3">
                                        <div id="ransomwareInfo" class="malware-info-panel">
                                            <h5 class="text-danger">Ransomware</h5>
                                            <p>Ransomware verschlüsselt Dateien und fordert Lösegeld für den Entschlüsselungsschlüssel. Bekannte Beispiele sind WannaCry, Petya und Ryuk.</p>
                                            <ul class="small">
                                                <li>Scannt das System nach wichtigen Dokumenten</li>
                                                <li>Verschlüsselt Dateien mit starker Verschlüsselung</li>
                                                <li>Zeigt Lösegeldnachricht mit Zahlungsanweisungen</li>
                                                <li>Kann sich über Netzwerke verbreiten</li>
                                            </ul>
                                        </div>
                                        <div id="trojanInfo" class="malware-info-panel d-none">
                                            <h5 class="text-warning">Trojan</h5>
                                            <p>Trojaner tarnen sich als legitime Software, enthalten aber versteckte schädliche Funktionen. Bekannte Beispiele sind Zeus, Emotet und TrickBot.</p>
                                            <ul class="small">
                                                <li>Tarnt sich als nützliche Anwendung</li>
                                                <li>Erstellt Hintertüren für den Remote-Zugriff</li>
                                                <li>Stiehlt sensible Daten (Passwörter, Banking-Infos)</li>
                                                <li>Kann als Downloader für weitere Malware dienen</li>
                                            </ul>
                                        </div>
                                        <div id="virusInfo" class="malware-info-panel d-none">
                                            <h5 class="text-info">Virus</h5>
                                            <p>Viren infizieren ausführbare Dateien und verbreiten sich, wenn diese ausgeführt werden. Bekannte Beispiele sind Melissa, ILOVEYOU und CIH/Chernobyl.</p>
                                            <ul class="small">
                                                <li>Infiziert ausführbare Dateien</li>
                                                <li>Aktiviert sich beim Ausführen infizierter Programme</li>
                                                <li>Kann Systemdateien beschädigen oder löschen</li>
                                                <li>Repliziert sich durch Infizieren weiterer Dateien</li>
                                            </ul>
                                        </div>
                                        <div id="wormInfo" class="malware-info-panel d-none">
                                            <h5 class="text-primary">Worm</h5>
                                            <p>Würmer verbreiten sich selbstständig über Netzwerke ohne menschliche Interaktion. Bekannte Beispiele sind SQL Slammer, Stuxnet und Conficker.</p>
                                            <ul class="small">
                                                <li>Verbreitet sich selbstständig über Netzwerke</li>
                                                <li>Nutzt Sicherheitslücken zur Infektion</li>
                                                <li>Kann hohe Netzwerklast verursachen</li>
                                                <li>Scannt aktiv nach verwundbaren Systemen</li>
                                            </ul>
                                        </div>
                                        <div id="rootkitInfo" class="malware-info-panel d-none">
                                            <h5 class="text-secondary">Rootkit</h5>
                                            <p>Rootkits verstecken sich tief im System und maskieren ihre eigene Anwesenheit. Bekannte Beispiele sind ZeroAccess, Necurs und TDL/Alureon.</p>
                                            <ul class="small">
                                                <li>Verbirgt seine Anwesenheit vor Antivirenprogrammen</li>
                                                <li>Modifiziert Systemfunktionen (Kernel-Hooks)</li>
                                                <li>Gewährt dauerhaften privilegierten Zugriff</li>
                                                <li>Sehr schwer zu entdecken und zu entfernen</li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="alert alert-dark mt-3 mb-0">
                                        <div class="d-flex">
                                            <i class="fas fa-shield-alt text-primary me-2 fs-4"></i>
                                            <div>
                                                <h6>Sicherheitshinweis</h6>
                                                <p class="small mb-0">
                                                    Dieser Simulator zeigt, wie unterschiedliche Malware-Typen funktionieren, um das Verständnis für Cybersicherheit zu fördern. Das Wissen über diese Bedrohungen hilft bei der Entwicklung besserer Schutzmaßnahmen.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-center">
                        {{ form.submit(class="btn btn-lg btn-outline-danger", id="simulateButton") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Simulation in Progress (hidden by default) -->
<div id="simulationProgressSection" class="row mb-4 d-none">
    <div class="col-12">
        <div class="card border-dark hacker-card">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-cogs fa-spin me-2"></i>Simulation läuft...</h3>
                    <div class="simulation-stats">
                        <span class="badge bg-primary terminal-badge">Target: <span id="simTargetSystem">System</span></span>
                        <span class="badge bg-danger terminal-badge">Type: <span id="simMalwareType">Malware</span></span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <p id="simulationStatusMessage" class="mb-2">Initialisiere Simulation...</p>
                <div class="progress mb-3">
                    <div id="simulationProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-danger" 
                         role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                </div>
                
                <div class="malware-simulation-log mt-3">
                    <div class="log-title">Simulation Log</div>
                    <div class="log-content" id="simulationOutput">
                        <div class="log-entry"><span class="time">[00:00:01]</span> <span class="text-primary">Initializing malware sandbox environment...</span></div>
                        <div class="log-entry"><span class="time">[00:00:02]</span> <span class="text-primary">Preparing target system emulation: <span class="sim-target">target</span></span></div>
                        <div class="log-entry"><span class="time">[00:00:03]</span> <span class="text-warning">Loading malware behavior patterns...</span></div>
                        <div class="log-entry"><span class="time">[00:00:04]</span> <span class="text-danger">Starting simulation in controlled environment...</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Simulation Results -->
{% if result %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card mb-4">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>Simulationsergebnisse
                    </h3>
                    <div class="simulation-stats">
                        <span class="badge bg-primary terminal-badge">Target: {{ result.target_system }}</span>
                        <span class="badge bg-danger terminal-badge">Type: {{ result.malware_type }}</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="alert alert-dark mb-4">
                    <i class="fas fa-info-circle me-2 text-primary"></i>
                    <strong>Simulationsinfo:</strong> Die folgenden Ergebnisse zeigen das typische Verhalten von <strong>{{ result.malware_type }}</strong> auf einem <strong>{{ result.target_system }}</strong>-System. Alle Aktionen wurden sicher in einer isolierten Umgebung simuliert.
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-dark h-100 mb-4">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Verhaltensanalyse</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="malware-behavior-timeline">
                                    {% for behavior in result.behaviors %}
                                    <div class="behavior-step">
                                        <div class="behavior-step-indicator">
                                            <div class="step-number">{{ loop.index }}</div>
                                            <div class="step-line"></div>
                                        </div>
                                        <div class="behavior-step-content">
                                            <div class="step-title">{{ behavior }}</div>
                                            <div class="step-details">
                                                {% if behavior == 'Scanning for document files' %}
                                                <p class="small">Sucht nach wertvollen Dokumenten (.docx, .pdf, .xlsx), um Ziele für die Verschlüsselung zu identifizieren.</p>
                                                {% elif behavior == 'File encryption simulation' %}
                                                <p class="small">Simuliert AES-256-Verschlüsselung von Dokumenten und Medien. Echte Ransomware würde die Dateien unbrauchbar machen.</p>
                                                {% elif behavior == 'Ransom note creation (simulated)' %}
                                                <p class="small">Erstellt eine Nachricht, die das Opfer über die Verschlüsselung informiert und Anweisungen zur Zahlung gibt.</p>
                                                {% elif behavior == 'Encryption key generation' %}
                                                <p class="small">Generiert asymmetrische Schlüsselpaare (RSA), wobei der private Schlüssel an den Angreifer gesendet würde.</p>
                                                
                                                {% elif behavior == 'Backdoor connection simulation' %}
                                                <p class="small">Öffnet einen versteckten Kommunikationskanal zu einem Command & Control Server, um Befehle zu empfangen.</p>
                                                {% elif behavior == 'Simulated data exfiltration' %}
                                                <p class="small">Lokalisiert und sammelt sensible Daten (Passwörter, Finanzdaten) für den Versand an den Angreifer.</p>
                                                {% elif behavior == 'Command & control communication' %}
                                                <p class="small">Etabliert sichere, verschlüsselte Kommunikation mit dem Steuerungsserver für Fernzugriff.</p>
                                                {% elif behavior == 'User activity monitoring' %}
                                                <p class="small">Überwacht Tastatureingaben, Screenshots und Browserdaten, um persönliche Informationen zu sammeln.</p>
                                                
                                                {% elif behavior == 'Self-replication mechanism' %}
                                                <p class="small">Kopiert sich in andere ausführbare Dateien, um die Persistenz und Verbreitung zu sichern.</p>
                                                {% elif behavior == 'File infection simulation' %}
                                                <p class="small">Fügt schädlichen Code in legitime Programmdateien ein, die bei Ausführung den Virus aktivieren.</p>
                                                {% elif behavior == 'Boot sector analysis' %}
                                                <p class="small">Untersucht und manipuliert den Boot-Sektor, um beim Systemstart automatisch geladen zu werden.</p>
                                                {% elif behavior == 'System modification attempt' %}
                                                <p class="small">Verändert Systemdateien und -einstellungen, um normale Antivirenfunktionen zu stören.</p>
                                                
                                                {% elif behavior == 'Network scanning simulation' %}
                                                <p class="small">Sucht nach anderen verwundbaren Systemen im Netzwerk, die infiziert werden können.</p>
                                                {% elif behavior == 'Remote exploit simulation' %}
                                                <p class="small">Nutzt bekannte Sicherheitslücken, um ohne Benutzerinteraktion auf Systeme zuzugreifen.</p>
                                                {% elif behavior == 'Propagation via network shares' %}
                                                <p class="small">Verbreitet sich über gemeinsam genutzte Netzwerkordner und zugängliche Ressourcen.</p>
                                                {% elif behavior == 'Self-replication routine' %}
                                                <p class="small">Erstellt Kopien, die automatisch auf neue Systeme übertragen und ausgeführt werden.</p>
                                                
                                                {% elif behavior == 'System hooking simulation' %}
                                                <p class="small">Manipuliert Systemfunktionen auf niedriger Ebene, um seine Aktivitäten zu verbergen.</p>
                                                {% elif behavior == 'Process hiding techniques' %}
                                                <p class="small">Versteckt malware-bezogene Prozesse vor dem Task-Manager und Systemmonitoring-Tools.</p>
                                                {% elif behavior == 'Privilege escalation attempt' %}
                                                <p class="small">Versucht, administrative Rechte zu erlangen, um tiefgreifende Systemänderungen vorzunehmen.</p>
                                                {% elif behavior == 'System file modification (simulated)' %}
                                                <p class="small">Ersetzt oder modifiziert Kernsystemdateien, um Persistenz und Tarnung zu gewährleisten.</p>
                                                {% else %}
                                                <p class="small">Simulierte Malware-Aktivität im Rahmen der Sicherheitsanalyse.</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-12">
                                <div class="card border-dark mb-4">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="mb-0"><i class="fas fa-route me-2"></i>Verbreitungsmethode</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="vector-icon text-center mb-3">
                                            {% if result.propagation == 'email' %}
                                            <i class="fas fa-envelope fa-4x text-warning"></i>
                                            <h5 class="mt-2">Email-Anhang</h5>
                                            {% elif result.propagation == 'network' %}
                                            <i class="fas fa-network-wired fa-4x text-primary"></i>
                                            <h5 class="mt-2">Netzwerk-Verbreitung</h5>
                                            {% elif result.propagation == 'usb' %}
                                            <i class="fas fa-usb fa-4x text-success"></i>
                                            <h5 class="mt-2">USB-Laufwerk</h5>
                                            {% elif result.propagation == 'download' %}
                                            <i class="fas fa-download fa-4x text-info"></i>
                                            <h5 class="mt-2">Bösartiger Download</h5>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="propagation-details">
                                            <h6>Vektormethode:</h6>
                                            <ul>
                                                {% for method in result.propagation_methods %}
                                                <li>{{ method }}</li>
                                                {% endfor %}
                                            </ul>
                                            
                                            <div class="alert alert-warning mt-3 mb-0">
                                                <i class="fas fa-shield-alt me-2"></i>
                                                <div>
                                                    <strong>Schutzmaßnahmen:</strong>
                                                    <ul class="mb-0 mt-1 small">
                                                        {% if result.propagation == 'email' %}
                                                        <li>Öffnen Sie keine Anhänge aus unbekannten Quellen</li>
                                                        <li>Aktivieren Sie erweiterte E-Mail-Filterung</li>
                                                        <li>Schulen Sie Benutzer in Bezug auf Phishing-Erkennung</li>
                                                        {% elif result.propagation == 'network' %}
                                                        <li>Halten Sie alle Systeme aktuell mit Sicherheitspatches</li>
                                                        <li>Implementieren Sie Netzwerksegmentierung</li>
                                                        <li>Verwenden Sie Intrusion Detection/Prevention-Systeme</li>
                                                        {% elif result.propagation == 'usb' %}
                                                        <li>Deaktivieren Sie Autorun/Autoplay für Wechselmedien</li>
                                                        <li>Scannen Sie externe Medien vor der Verwendung</li>
                                                        <li>Implementieren Sie eine Gerätesteuerungsrichtlinie</li>
                                                        {% elif result.propagation == 'download' %}
                                                        <li>Beziehen Sie Software nur aus vertrauenswürdigen Quellen</li>
                                                        <li>Aktivieren Sie Web-Filterung und Sandbox-Technologie</li>
                                                        <li>Prüfen Sie Downloads auf Schadcode vor der Ausführung</li>
                                                        {% endif %}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="card border-dark">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Auswirkungsanalyse</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center mb-3">
                                            <div class="col-4">
                                                <div class="impact-meter">
                                                    <div class="impact-label">System</div>
                                                    {% if result.malware_type in ['rootkit', 'ransomware'] %}
                                                    <div class="impact-value high">Hoch</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-danger" style="width: 85%"></div>
                                                    </div>
                                                    {% elif result.malware_type in ['virus', 'worm'] %}
                                                    <div class="impact-value medium">Mittel</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-warning" style="width: 60%"></div>
                                                    </div>
                                                    {% else %}
                                                    <div class="impact-value low">Niedrig</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-info" style="width: 35%"></div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="impact-meter">
                                                    <div class="impact-label">Daten</div>
                                                    {% if result.malware_type in ['ransomware', 'trojan'] %}
                                                    <div class="impact-value high">Hoch</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-danger" style="width: 90%"></div>
                                                    </div>
                                                    {% elif result.malware_type in ['virus'] %}
                                                    <div class="impact-value medium">Mittel</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-warning" style="width: 55%"></div>
                                                    </div>
                                                    {% else %}
                                                    <div class="impact-value low">Niedrig</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-info" style="width: 30%"></div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="impact-meter">
                                                    <div class="impact-label">Netzwerk</div>
                                                    {% if result.malware_type in ['worm'] %}
                                                    <div class="impact-value high">Hoch</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-danger" style="width: 95%"></div>
                                                    </div>
                                                    {% elif result.malware_type in ['trojan', 'rootkit'] %}
                                                    <div class="impact-value medium">Mittel</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-warning" style="width: 65%"></div>
                                                    </div>
                                                    {% else %}
                                                    <div class="impact-value low">Niedrig</div>
                                                    <div class="impact-bar">
                                                        <div class="impact-fill bg-info" style="width: 25%"></div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="alert alert-dark mb-0">
                                            <div class="d-flex">
                                                <i class="fas fa-lightbulb text-warning me-2 fs-4"></i>
                                                <div>
                                                    <h6>Fazit für {{ result.malware_type }}</h6>
                                                    <p class="small mb-0">
                                                        {% if result.malware_type == 'ransomware' %}
                                                        Ransomware ist besonders gefährlich für die Datenverfügbarkeit und kann erhebliche finanzielle Schäden verursachen. Regelmäßige Backups, die offline oder isoliert gespeichert werden, sind die beste Verteidigung.
                                                        {% elif result.malware_type == 'trojan' %}
                                                        Trojaner bleiben oft lange unentdeckt und stehlen kontinuierlich sensible Daten. Strenge Anwendungskontrollen, regelmäßige Sicherheitsaudits und Benutzeraufklärung sind entscheidend für den Schutz.
                                                        {% elif result.malware_type == 'virus' %}
                                                        Viren können Systemdateien beschädigen und sich über Dateiaustausch verbreiten. Aktuelle Antivirensoftware und vorsichtiger Umgang mit Dateien aus unbekannten Quellen bieten den besten Schutz.
                                                        {% elif result.malware_type == 'worm' %}
                                                        Würmer verbreiten sich aggressiv über Netzwerke und können schnell ganze Organisationen befallen. Netzwerksegmentierung, Firewalls und zeitnahe Sicherheitspatches sind entscheidend für die Eindämmung.
                                                        {% elif result.malware_type == 'rootkit' %}
                                                        Rootkits sind extrem schwer zu entdecken und zu entfernen, da sie tief im System verankert sind. Spezialisierte Erkennungstools und regelmäßige Clean-Installs bei kritischen Systemen können helfen.
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <a href="{{ url_for('malware_simulator') }}" class="btn btn-outline-primary">
                        <i class="fas fa-sync-alt me-2"></i>Neue Simulation
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Malware type selector
    const malwareTypeSelect = document.getElementById('malwareTypeSelect');
    const infoPanels = document.querySelectorAll('.malware-info-panel');
    
    if (malwareTypeSelect) {
        malwareTypeSelect.addEventListener('change', function() {
            const selectedType = this.value;
            
            // Hide all info panels
            infoPanels.forEach(panel => {
                panel.classList.add('d-none');
            });
            
            // Show selected panel
            const selectedPanel = document.getElementById(selectedType + 'Info');
            if (selectedPanel) {
                selectedPanel.classList.remove('d-none');
            }
        });
    }
    
    // Simulation progress animation
    const simulateForm = document.getElementById('malwareSimForm');
    const progressSection = document.getElementById('simulationProgressSection');
    const progressBar = document.getElementById('simulationProgressBar');
    const statusMessage = document.getElementById('simulationStatusMessage');
    const simulationOutput = document.getElementById('simulationOutput');
    
    // Target system in logs
    const targetSystemInput = document.getElementById('target_system');
    const malwareTypeSelect2 = document.getElementById('malware_type');
    const simTargetElements = document.querySelectorAll('.sim-target');
    const simTargetSystem = document.getElementById('simTargetSystem');
    const simMalwareType = document.getElementById('simMalwareType');
    
    if(targetSystemInput && simTargetElements) {
        simTargetElements.forEach(el => {
            el.textContent = targetSystemInput.value || 'target system';
        });
    }
    
    if(targetSystemInput && simTargetSystem) {
        simTargetSystem.textContent = targetSystemInput.value || 'System';
    }
    
    if(malwareTypeSelect2 && simMalwareType) {
        simMalwareType.textContent = malwareTypeSelect2.options[malwareTypeSelect2.selectedIndex].text || 'Malware';
    }
    
    // Simulation progress (commented out for now since we use standard form submission)
    /*
    if(simulateForm) {
        simulateForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Update simulation target display
            if(simTargetSystem) {
                simTargetSystem.textContent = targetSystemInput.value || 'System';
            }
            
            if(simMalwareType) {
                simMalwareType.textContent = malwareTypeSelect2.options[malwareTypeSelect2.selectedIndex].text || 'Malware';
            }
            
            // Show progress section
            progressSection.classList.remove('d-none');
            
            // Scroll to progress section
            progressSection.scrollIntoView({ behavior: 'smooth' });
            
            // Start simulation animation
            let progress = 0;
            let simTimer = setInterval(function() {
                progress += Math.random() * 5;
                
                if(progress >= 100) {
                    progress = 100;
                    clearInterval(simTimer);
                    
                    // Submit the form after animation completes
                    setTimeout(() => {
                        simulateForm.submit();
                    }, 500);
                }
                
                // Update progress
                progressBar.style.width = progress + '%';
                progressBar.setAttribute('aria-valuenow', progress);
                
                // Update status message
                if(progress < 20) {
                    statusMessage.textContent = 'Initialisiere Sandbox-Umgebung...';
                } else if(progress < 40) {
                    statusMessage.textContent = 'Bereite Malware-Simulation vor...';
                } else if(progress < 60) {
                    statusMessage.textContent = 'Analysiere ' + (malwareTypeSelect2.options[malwareTypeSelect2.selectedIndex].text || 'Malware') + ' Verhalten...';
                } else if(progress < 80) {
                    statusMessage.textContent = 'Überwache System-Interaktionen...';
                } else {
                    statusMessage.textContent = 'Erstelle Verhaltensanalyse...';
                }
                
                // Add log entries dynamically based on selected malware type
                const malwareType = malwareTypeSelect2.value;
                
                if(progress > 15 && progress < 20) {
                    addLogEntry('Sandbox isolation complete. Beginning ' + malwareType + ' simulation...', 'success');
                } else if(progress > 35 && progress < 40) {
                    if(malwareType === 'ransomware') {
                        addLogEntry('Monitoring file system activity for encryption patterns...', 'warning');
                    } else if(malwareType === 'trojan') {
                        addLogEntry('Detecting covert communication channels...', 'warning');
                    } else if(malwareType === 'virus') {
                        addLogEntry('Tracking executable file modifications...', 'warning');
                    } else if(malwareType === 'worm') {
                        addLogEntry('Monitoring network scanning behavior...', 'warning');
                    } else if(malwareType === 'rootkit') {
                        addLogEntry('Analyzing system call hooking attempts...', 'warning');
                    }
                } else if(progress > 60 && progress < 65) {
                    if(malwareType === 'ransomware') {
                        addLogEntry('Detected file encryption activity targeting documents...', 'danger');
                    } else if(malwareType === 'trojan') {
                        addLogEntry('Detected data exfiltration attempt to C&C server...', 'danger');
                    } else if(malwareType === 'virus') {
                        addLogEntry('Multiple process injection attempts detected...', 'danger');
                    } else if(malwareType === 'worm') {
                        addLogEntry('Active propagation to other systems detected...', 'danger');
                    } else if(malwareType === 'rootkit') {
                        addLogEntry('System process hiding techniques observed...', 'danger');
                    }
                } else if(progress > 80 && progress < 85) {
                    addLogEntry('Compiling behavioral analysis report...', 'info');
                } else if(progress > 95) {
                    addLogEntry('Simulation complete. Generating detailed report...', 'success');
                }
            }, 200);
        });
    }
    */
    
    // Function to add log entries
    function addLogEntry(message, type = 'info') {
        if(!simulationOutput) return;
        
        const now = new Date();
        const timeFormatted = [
            String(now.getMinutes()).padStart(2, '0'),
            String(now.getSeconds()).padStart(2, '0')
        ].join(':');
        
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        
        const timeSpan = document.createElement('span');
        timeSpan.className = 'time';
        timeSpan.textContent = `[${timeFormatted}]`;
        
        const messageSpan = document.createElement('span');
        switch(type) {
            case 'success':
                messageSpan.className = 'text-success';
                break;
            case 'warning':
                messageSpan.className = 'text-warning';
                break;
            case 'danger':
                messageSpan.className = 'text-danger';
                break;
            default:
                messageSpan.className = 'text-primary';
                break;
        }
        messageSpan.textContent = message;
        
        entry.appendChild(timeSpan);
        entry.appendChild(document.createTextNode(' '));
        entry.appendChild(messageSpan);
        
        simulationOutput.appendChild(entry);
        simulationOutput.scrollTop = simulationOutput.scrollHeight;
    }
});
</script>
<style>
/* Malware Info Panels */
.malware-info-panel {
    padding: 0.5rem;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.malware-info-panel h5 {
    margin-bottom: 0.75rem;
}

.malware-info-panel p {
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
}

/* Simulation log */
.malware-simulation-log {
    border: 1px solid #333;
    border-radius: 4px;
    overflow: hidden;
}

.log-title {
    background-color: #131313;
    color: var(--hacker-primary);
    padding: 0.5rem;
    font-weight: bold;
    border-bottom: 1px solid #333;
    font-size: 0.9rem;
}

.log-content {
    background-color: #0c0c0c;
    padding: 0.5rem;
    font-family: var(--mono-font);
    font-size: 0.8rem;
    height: 150px;
    overflow-y: auto;
}

.log-entry {
    margin-bottom: 0.25rem;
    line-height: 1.4;
    display: flex;
}

.log-entry .time {
    color: #888;
    margin-right: 0.5rem;
    min-width: 70px;
}

/* Behavior timeline */
.malware-behavior-timeline {
    padding: 1rem;
}

.behavior-step {
    display: flex;
    margin-bottom: 1.5rem;
}

.behavior-step:last-child {
    margin-bottom: 0;
}

.behavior-step-indicator {
    position: relative;
    padding-right: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.step-number {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background-color: #333;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.8rem;
}

.step-line {
    position: absolute;
    top: 28px;
    bottom: -28px;
    width: 2px;
    background-color: #333;
}

.behavior-step:last-child .step-line {
    display: none;
}

.behavior-step-content {
    flex: 1;
}

.step-title {
    font-weight: bold;
    margin-bottom: 0.25rem;
    color: var(--hacker-primary);
}

.step-details {
    padding-left: 0.5rem;
    border-left: 1px dashed #333;
}

/* Impact meters */
.impact-meter {
    margin-bottom: 1rem;
}

.impact-label {
    font-weight: bold;
    margin-bottom: 0.25rem;
}

.impact-value {
    font-weight: bold;
    margin-bottom: 0.25rem;
}

.impact-value.high {
    color: #dc3545;
}

.impact-value.medium {
    color: #ffc107;
}

.impact-value.low {
    color: #17a2b8;
}

.impact-bar {
    height: 10px;
    background-color: #333;
    border-radius: 5px;
    overflow: hidden;
}

.impact-fill {
    height: 100%;
    border-radius: 5px;
}

/* Vector icon */
.vector-icon {
    padding: 1rem 0;
}

.vector-icon i {
    margin-bottom: 0.5rem;
}
</style>
{% endblock %}