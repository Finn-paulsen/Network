{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card mb-4">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">
                        <i class="fas fa-bug me-2"></i>Exploit & Vulnerability Scanner
                    </h2>
                    <div class="d-flex align-items-center">
                        <div class="status-indicator status-warning me-2"></div>
                        <span class="badge bg-warning terminal-badge">Advanced Tool</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="alert alert-warning terminal-tip">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Sicherheitshinweis:</strong> Dieses Tool ist ausschließlich für Bildungszwecke und autorisierte Sicherheitstests konzipiert. Der unbefugte Einsatz gegen fremde Systeme ist illegal.
                </div>
                
                <form method="POST" action="{{ url_for('exploit_scanner') }}" id="vulnerabilityScanForm">
                    {{ form.hidden_tag() }}
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="target_url" class="form-label">{{ form.target_url.label }}</label>
                            <div class="input-group">
                                <span class="input-group-text bg-dark text-light"><i class="fas fa-globe"></i></span>
                                {{ form.target_url(class="form-control terminal-input", placeholder="https://example.com oder 192.168.1.1") }}
                            </div>
                            {% if form.target_url.errors %}
                                <div class="text-danger">
                                    {% for error in form.target_url.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4">
                            <label for="scan_type" class="form-label">{{ form.scan_type.label }}</label>
                            {{ form.scan_type(class="form-select terminal-input") }}
                            {% if form.scan_type.errors %}
                                <div class="text-danger">
                                    {% for error in form.scan_type.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4">
                            <label for="intensity" class="form-label">{{ form.intensity.label }}</label>
                            {{ form.intensity(class="form-select terminal-input") }}
                            {% if form.intensity.errors %}
                                <div class="text-danger">
                                    {% for error in form.intensity.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mt-3 text-center">
                        {{ form.submit(class="btn btn-outline-warning", id="scanButton") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Scan in Progress (hidden by default) -->
<div id="scanProgressSection" class="row mb-4 d-none">
    <div class="col-12">
        <div class="card border-dark hacker-card">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-spinner fa-spin me-2"></i>Scanning...</h3>
                    <div class="scan-stats">
                        <span class="badge bg-primary terminal-badge">Modules: <span id="moduleCount">6</span></span>
                        <span class="badge bg-warning terminal-badge">Tests: <span id="testCount">42</span></span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <p id="scanStatusMessage" class="mb-2">Initialisiere Scan-Module...</p>
                <div class="progress mb-3">
                    <div id="scanProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-warning" 
                         role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                </div>
                
                <div class="vulnerability-scan-log mt-3">
                    <div class="scan-log-title">Scanner Output</div>
                    <div class="scan-log-content" id="scannerOutput">
                        <div class="scan-log-entry"><span class="time">[00:00:01]</span> <span class="text-primary">Initializing scanner modules...</span></div>
                        <div class="scan-log-entry"><span class="time">[00:00:02]</span> <span class="text-success">Target acquisition: <span class="target-url">target</span></span></div>
                        <div class="scan-log-entry"><span class="time">[00:00:03]</span> <span class="text-primary">Loading vulnerability database...</span></div>
                        <div class="scan-log-entry"><span class="time">[00:00:04]</span> <span class="text-warning">Starting port and service discovery...</span></div>
                        <div class="scan-log-entry"><span class="time">[00:00:05]</span> <span class="text-success">Probing target for open services...</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scan Results -->
{% if result and result.status == 'completed' %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card mb-4">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>Scan Summary
                    </h3>
                    <div class="scan-stats">
                        <span class="badge bg-primary terminal-badge">Target: {{ result.target }}</span>
                        <span class="badge bg-info terminal-badge">Time: {{ "%.2f"|format(result.scan_time) }}s</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center h-100 border-dark">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h2 class="display-4 mb-0 fw-bold text-danger">{{ result.severity_counts.critical }}</h2>
                                <p class="mb-0">Kritische Schwachstellen</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center h-100 border-dark">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h2 class="display-4 mb-0 fw-bold text-warning">{{ result.severity_counts.high }}</h2>
                                <p class="mb-0">Hohe Risiken</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center h-100 border-dark">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h2 class="display-4 mb-0 fw-bold text-info">{{ result.severity_counts.medium }}</h2>
                                <p class="mb-0">Mittlere Risiken</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center h-100 border-dark">
                            <div class="card-body d-flex flex-column justify-content-center">
                                <h2 class="display-4 mb-0 fw-bold text-success">{{ result.severity_counts.low }}</h2>
                                <p class="mb-0">Niedrige Risiken</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h5 class="mb-3"><i class="fas fa-chart-pie me-2"></i>Zusammenfassung nach Schweregrad</h5>
                    <div class="progress" style="height: 25px;">
                        {% set critical_percentage = (result.severity_counts.critical / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 %}
                        {% set high_percentage = (result.severity_counts.high / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 %}
                        {% set medium_percentage = (result.severity_counts.medium / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 %}
                        {% set low_percentage = (result.severity_counts.low / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 %}
                        
                        {% if critical_percentage > 0 %}
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ critical_percentage }}%" 
                             aria-valuenow="{{ critical_percentage }}" aria-valuemin="0" aria-valuemax="100">
                            {% if critical_percentage >= 5 %}Critical{% endif %}
                        </div>
                        {% endif %}
                        
                        {% if high_percentage > 0 %}
                        <div class="progress-bar bg-warning" role="progressbar" style="width: {{ high_percentage }}%" 
                             aria-valuenow="{{ high_percentage }}" aria-valuemin="0" aria-valuemax="100">
                            {% if high_percentage >= 5 %}High{% endif %}
                        </div>
                        {% endif %}
                        
                        {% if medium_percentage > 0 %}
                        <div class="progress-bar bg-info" role="progressbar" style="width: {{ medium_percentage }}%" 
                             aria-valuenow="{{ medium_percentage }}" aria-valuemin="0" aria-valuemax="100">
                            {% if medium_percentage >= 5 %}Medium{% endif %}
                        </div>
                        {% endif %}
                        
                        {% if low_percentage > 0 %}
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ low_percentage }}%" 
                             aria-valuenow="{{ low_percentage }}" aria-valuemin="0" aria-valuemax="100">
                            {% if low_percentage >= 5 %}Low{% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5 class="mb-3"><i class="fas fa-exclamation-triangle me-2"></i>Gefundene Schwachstellen</h5>
                    
                    {% if result.vulnerabilities %}
                    <div class="vulnerability-list">
                        {% for vuln in result.vulnerabilities %}
                        <div class="vulnerability-item mb-3">
                            <div class="vulnerability-header {{ 'bg-danger text-white' if vuln.severity == 'critical' else 'bg-warning text-dark' if vuln.severity == 'high' else 'bg-info text-white' if vuln.severity == 'medium' else 'bg-success text-white' }}">
                                <div class="severity-indicator"></div>
                                <span class="vuln-name">{{ vuln.name }}</span>
                                <span class="vuln-severity">{{ vuln.severity|upper }}</span>
                                {% if vuln.cve and vuln.cve != 'N/A' %}
                                <span class="vuln-cve">{{ vuln.cve }}</span>
                                {% endif %}
                            </div>
                            <div class="vulnerability-details">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h6 class="mt-2">Beschreibung:</h6>
                                        <p>
                                            {% if vuln.name == 'Obsolete HTTP Headers' %}
                                            Der Server verwendet veraltete oder nicht sichere HTTP-Header, was Informationen über die Serverinfrastruktur preisgeben kann.
                                            {% elif vuln.name == 'Missing Security Headers' %}
                                            Dem Server fehlen wichtige Sicherheits-Header wie Content-Security-Policy oder X-XSS-Protection, die zusätzlichen Schutz bieten würden.
                                            {% elif vuln.name == 'Information Disclosure' %}
                                            Der Server gibt zu viele Informationen über seine Konfiguration oder Software-Versionen preis, was Angreifern helfen kann.
                                            {% elif vuln.name == 'Potential XSS Vulnerability' %}
                                            Es wurden Eingabefelder gefunden, die möglicherweise anfällig für Cross-Site-Scripting-Angriffe sind, was zur Ausführung von schädlichem Code führen kann.
                                            {% elif vuln.name == 'Session Management Issue' %}
                                            Probleme mit der Session-Verwaltung können zur Übernahme von Benutzerkonten führen.
                                            {% elif vuln.name == 'Weak Password Policy' %}
                                            Es wurden schwache Passwortrichtlinien erkannt, die leicht zu erratende Passwörter zulassen könnten.
                                            {% elif vuln.name == 'Insecure Cookie Flags' %}
                                            Cookies werden ohne sichere Flags wie HttpOnly oder Secure gesetzt, was das Risiko von Cookie-Diebstahl erhöht.
                                            {% elif vuln.name == 'Potential DoS Vulnerability' %}
                                            Es wurde eine potenzielle Denial-of-Service-Schwachstelle erkannt, die zur Serviceunterbrechung führen könnte.
                                            {% elif vuln.name == 'Resource Exhaustion Risk' %}
                                            Ressourcenintensive Operationen könnten ausgenutzt werden, um Systemressourcen zu erschöpfen.
                                            {% elif vuln.name == 'Potential SQL Injection' %}
                                            Es wurden Eingabefelder erkannt, die möglicherweise anfällig für SQL-Injection-Angriffe sind, was unbefugten Datenbankzugriff ermöglichen könnte.
                                            {% elif vuln.name == 'Database Error Disclosure' %}
                                            Datenbank-Fehlermeldungen werden an den Client weitergeleitet, was wertvolle Informationen über die Datenbankstruktur preisgeben kann.
                                            {% elif vuln.name == 'Reflected XSS Vulnerability' %}
                                            Benutzer-Eingaben werden ohne ausreichende Bereinigung reflektiert, was Cross-Site-Scripting ermöglicht.
                                            {% elif vuln.name == 'Stored XSS Vulnerability' %}
                                            Benutzer-Eingaben werden ohne ausreichende Bereinigung gespeichert und später angezeigt, was dauerhafte XSS-Angriffe ermöglicht.
                                            {% elif vuln.name == 'DOM-based XSS Risk' %}
                                            Client-seitiger JavaScript-Code verarbeitet Eingaben unsicher, was zu DOM-basierten XSS-Angriffen führen kann.
                                            {% elif vuln.name == 'Outdated Software Version' %}
                                            Es wurde eine veraltete Software-Version erkannt, die bekannte Sicherheitslücken enthalten könnte.
                                            {% elif vuln.name == 'Insecure Transport Layer' %}
                                            Die Datenübertragung erfolgt über unsichere Kanäle (z.B. HTTP statt HTTPS), was Abhören und Man-in-the-Middle-Angriffe ermöglicht.
                                            {% elif vuln.name == 'Default Credentials Risk' %}
                                            Es wurden möglicherweise Standard-Zugangsdaten erkannt, die leicht zu erraten sind und Unbefugten Zugang gewähren könnten.
                                            {% else %}
                                            Eine potenzielle Sicherheitsschwachstelle wurde erkannt, die weitere Untersuchung erfordert.
                                            {% endif %}
                                        </p>
                                    </div>
                                    <div class="col-md-4">
                                        <h6 class="mt-2">Empfehlungen:</h6>
                                        <ul class="small">
                                            {% if vuln.name == 'Obsolete HTTP Headers' %}
                                            <li>Aktualisieren Sie die Serverkonfiguration</li>
                                            <li>Entfernen Sie unnötige Header-Informationen</li>
                                            <li>Implementieren Sie moderne Sicherheits-Header</li>
                                            {% elif vuln.name == 'Missing Security Headers' %}
                                            <li>Implementieren Sie Content-Security-Policy</li>
                                            <li>Aktivieren Sie X-XSS-Protection und X-Frame-Options</li>
                                            <li>Konfigurieren Sie HSTS für sichere Verbindungen</li>
                                            {% elif vuln.name == 'Information Disclosure' %}
                                            <li>Deaktivieren Sie detaillierte Fehlermeldungen</li>
                                            <li>Verbergen Sie Software-Versionen</li>
                                            <li>Beschränken Sie die Informationen in Header-Antworten</li>
                                            {% elif vuln.name == 'Potential XSS Vulnerability' %}
                                            <li>Implementieren Sie Output-Encoding</li>
                                            <li>Verwenden Sie Content-Security-Policy</li>
                                            <li>Validieren Sie alle Benutzereingaben</li>
                                            {% elif vuln.name == 'Session Management Issue' %}
                                            <li>Implementieren Sie sichere Session-IDs</li>
                                            <li>Konfigurieren Sie Session-Timeouts</li>
                                            <li>Verwenden Sie sichere Cookie-Flags</li>
                                            {% elif vuln.name == 'Weak Password Policy' %}
                                            <li>Fordern Sie komplexe Passwörter</li>
                                            <li>Implementieren Sie Passwort-Stärke-Überprüfungen</li>
                                            <li>Setzen Sie Passwort-Rotationen ein</li>
                                            {% elif vuln.name == 'Insecure Cookie Flags' %}
                                            <li>Aktivieren Sie HttpOnly und Secure Flags</li>
                                            <li>Implementieren Sie SameSite-Beschränkungen</li>
                                            <li>Definieren Sie angemessene Cookie-Lebensdauer</li>
                                            {% elif vuln.name == 'Potential DoS Vulnerability' %}
                                            <li>Implementieren Sie Rate-Limiting</li>
                                            <li>Verwenden Sie Load-Balancer</li>
                                            <li>Aktivieren Sie DDOS-Schutz</li>
                                            {% elif vuln.name == 'Resource Exhaustion Risk' %}
                                            <li>Begrenzen Sie ressourcenintensive Operationen</li>
                                            <li>Implementieren Sie Timeouts für Anfragen</li>
                                            <li>Überwachen Sie Ressourcennutzung</li>
                                            {% elif vuln.name == 'Potential SQL Injection' %}
                                            <li>Verwenden Sie parametrisierte Abfragen</li>
                                            <li>Implementieren Sie ORM-Frameworks</li>
                                            <li>Validieren und bereinigen Sie alle Eingaben</li>
                                            {% elif vuln.name == 'Database Error Disclosure' %}
                                            <li>Unterdrücken Sie detaillierte Datenbank-Fehler</li>
                                            <li>Implementieren Sie generische Fehlermeldungen</li>
                                            <li>Protokollieren Sie Fehler serverseitig</li>
                                            {% elif vuln.name == 'Reflected XSS Vulnerability' %}
                                            <li>Bereinigen Sie alle Benutzereingaben</li>
                                            <li>Implementieren Sie kontextbezogenes Encoding</li>
                                            <li>Verwenden Sie XSS-Filter und CSP</li>
                                            {% elif vuln.name == 'Stored XSS Vulnerability' %}
                                            <li>Bereinigen Sie alle gespeicherten Daten</li>
                                            <li>Verwenden Sie HTML-Sanitizer-Bibliotheken</li>
                                            <li>Implementieren Sie Ausgabevalidierung</li>
                                            {% elif vuln.name == 'DOM-based XSS Risk' %}
                                            <li>Sichern Sie clientseitigen JavaScript-Code</li>
                                            <li>Verwenden Sie sichere DOM-Manipulationsmethoden</li>
                                            <li>Vermeiden Sie eval() und document.write()</li>
                                            {% elif vuln.name == 'Outdated Software Version' %}
                                            <li>Aktualisieren Sie auf die neueste Version</li>
                                            <li>Implementieren Sie regelmäßige Updates</li>
                                            <li>Verfolgen Sie CVE-Meldungen</li>
                                            {% elif vuln.name == 'Insecure Transport Layer' %}
                                            <li>Implementieren Sie HTTPS für alle Verbindungen</li>
                                            <li>Konfigurieren Sie TLS 1.2 oder höher</li>
                                            <li>Verwenden Sie HSTS, um HTTPS zu erzwingen</li>
                                            {% elif vuln.name == 'Default Credentials Risk' %}
                                            <li>Ändern Sie alle Standard-Zugangsdaten</li>
                                            <li>Implementieren Sie komplexe Passwörter</li>
                                            <li>Beschränken Sie den Admin-Zugriff</li>
                                            {% else %}
                                            <li>Führen Sie eine detaillierte Analyse durch</li>
                                            <li>Aktualisieren Sie betroffene Komponenten</li>
                                            <li>Implementieren Sie Best Practices</li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        Keine Schwachstellen gefunden. Das System scheint gut geschützt zu sein.
                    </div>
                    {% endif %}
                </div>
                
                <div class="mt-4 pt-3 border-top">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="mb-3"><i class="fas fa-info-circle me-2"></i>Scan-Informationen</h5>
                            <table class="table table-sm">
                                <tr>
                                    <th>Ziel:</th>
                                    <td>{{ result.target }}</td>
                                </tr>
                                <tr>
                                    <th>Scan-Typ:</th>
                                    <td>
                                        {% if result.scan_type == 'basic' %}
                                        Basis-Schwachstellenscan
                                        {% elif result.scan_type == 'advanced' %}
                                        Erweiterter Schwachstellenscan
                                        {% elif result.scan_type == 'dos' %}
                                        DoS-Schwachstellentest
                                        {% elif result.scan_type == 'sqli' %}
                                        SQL-Injection-Test
                                        {% elif result.scan_type == 'xss' %}
                                        XSS-Schwachstellentest
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Intensität:</th>
                                    <td>
                                        {% if result.intensity == 'low' %}
                                        Niedrig (Educational)
                                        {% elif result.intensity == 'medium' %}
                                        Mittel (Simuliert)
                                        {% elif result.intensity == 'high' %}
                                        Hoch (Simuliert)
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Dauer:</th>
                                    <td>{{ "%.2f"|format(result.scan_time) }} Sekunden</td>
                                </tr>
                                <tr>
                                    <th>Zeitstempel:</th>
                                    <td>{{ result.timestamp }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5 class="mb-3"><i class="fas fa-clipboard-list me-2"></i>Aktionsplan</h5>
                            <div class="actions-list">
                                {% if result.total_vulnerabilities > 0 %}
                                <div class="alert alert-dark mb-3">
                                    <p class="mb-2"><strong>Empfohlene Maßnahmen:</strong></p>
                                    <ol class="mb-0 small">
                                        {% if result.severity_counts.critical > 0 %}
                                        <li class="text-danger fw-bold">Beheben Sie umgehend die kritischen Schwachstellen</li>
                                        {% endif %}
                                        {% if result.severity_counts.high > 0 %}
                                        <li class="text-warning fw-bold">Adressieren Sie hochriskante Schwachstellen innerhalb von 7 Tagen</li>
                                        {% endif %}
                                        {% if result.severity_counts.medium > 0 %}
                                        <li>Planen Sie die Behebung mittlerer Risiken innerhalb von 30 Tagen</li>
                                        {% endif %}
                                        {% if result.severity_counts.low > 0 %}
                                        <li>Dokumentieren Sie niedrige Risiken und beheben Sie sie bei zukünftigen Updates</li>
                                        {% endif %}
                                        <li>Führen Sie nach Behebung einen erneuten Scan durch</li>
                                        <li>Implementieren Sie kontinuierliche Sicherheitsüberprüfungen</li>
                                    </ol>
                                </div>
                                {% else %}
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <p class="mb-0">Keine unmittelbaren Maßnahmen erforderlich. Führen Sie regelmäßige Sicherheitsüberprüfungen durch, um den Schutz aufrechtzuerhalten.</p>
                                </div>
                                {% endif %}
                                
                                <div class="text-center mt-3">
                                    <a href="{{ url_for('exploit_scanner') }}" class="btn btn-outline-primary">
                                        <i class="fas fa-sync-alt me-2"></i>Neuen Scan starten
                                    </a>
                                    {% if result.total_vulnerabilities > 0 %}
                                    <button class="btn btn-outline-danger ms-2" onclick="printReport()">
                                        <i class="fas fa-file-pdf me-2"></i>Report exportieren
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if result and result.status == 'error' %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card">
            <div class="card-header bg-dark text-white">
                <h3 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Scan-Fehler</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <i class="fas fa-times-circle me-2"></i>
                    {{ result.message }}
                </div>
                <div class="text-center mt-3">
                    <a href="{{ url_for('exploit_scanner') }}" class="btn btn-outline-primary">
                        <i class="fas fa-sync-alt me-2"></i>Erneut versuchen
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const scanForm = document.getElementById('vulnerabilityScanForm');
    const scanProgressSection = document.getElementById('scanProgressSection');
    const scanProgressBar = document.getElementById('scanProgressBar');
    const scanStatusMessage = document.getElementById('scanStatusMessage');
    const scannerOutput = document.getElementById('scannerOutput');
    
    // Target URL in logs
    const targetUrlElements = document.querySelectorAll('.target-url');
    const targetUrlInput = document.getElementById('target_url');
    if(targetUrlInput && targetUrlElements) {
        targetUrlElements.forEach(el => {
            el.textContent = targetUrlInput.value || 'target';
        });
    }
    
    // Disable this for now as we're submitting the form normally
    // If we want to add an AJAX submission later, we can uncomment this
    /*
    if(scanForm) {
        scanForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show progress section
            scanProgressSection.classList.remove('d-none');
            
            // Start scan simulation
            let progress = 0;
            let scanTimer = setInterval(function() {
                progress += Math.random() * 10;
                
                if(progress >= 100) {
                    progress = 100;
                    clearInterval(scanTimer);
                    
                    // Submit the form after animation completes
                    setTimeout(() => {
                        scanForm.submit();
                    }, 500);
                }
                
                // Update progress
                scanProgressBar.style.width = progress + '%';
                scanProgressBar.setAttribute('aria-valuenow', progress);
                
                // Update status message
                if(progress < 20) {
                    scanStatusMessage.textContent = 'Initialisiere Scanner...';
                } else if(progress < 40) {
                    scanStatusMessage.textContent = 'Port-Scanning...';
                } else if(progress < 60) {
                    scanStatusMessage.textContent = 'Service-Identifikation...';
                } else if(progress < 80) {
                    scanStatusMessage.textContent = 'Überprüfe Schwachstellen...';
                } else {
                    scanStatusMessage.textContent = 'Analysiere Ergebnisse...';
                }
                
                // Add log entries dynamically
                if(progress > 20 && progress < 25) {
                    addLogEntry('Port 80 (HTTP) offen gefunden');
                } else if(progress > 40 && progress < 45) {
                    addLogEntry('Port 443 (HTTPS) offen gefunden');
                } else if(progress > 60 && progress < 65) {
                    addLogEntry('Web-Server-Version identifiziert');
                } else if(progress > 80 && progress < 85) {
                    addLogEntry('Verwundbarkeitsanalyse abgeschlossen');
                }
            }, 200);
        });
    }
    */
    
    // Function to add log entries
    function addLogEntry(message, type = 'info') {
        if(!scannerOutput) return;
        
        const now = new Date();
        const timeFormatted = [
            String(now.getMinutes()).padStart(2, '0'),
            String(now.getSeconds()).padStart(2, '0')
        ].join(':');
        
        const entry = document.createElement('div');
        entry.className = 'scan-log-entry';
        
        const timeSpan = document.createElement('span');
        timeSpan.className = 'time';
        timeSpan.textContent = `[${timeFormatted}]`;
        
        const messageSpan = document.createElement('span');
        switch(type) {
            case 'success':
                messageSpan.className = 'text-success';
                break;
            case 'warning':
                messageSpan.className = 'text-warning';
                break;
            case 'error':
                messageSpan.className = 'text-danger';
                break;
            default:
                messageSpan.className = 'text-primary';
                break;
        }
        messageSpan.textContent = message;
        
        entry.appendChild(timeSpan);
        entry.appendChild(document.createTextNode(' '));
        entry.appendChild(messageSpan);
        
        scannerOutput.appendChild(entry);
        scannerOutput.scrollTop = scannerOutput.scrollHeight;
    }
    
    // Print report function
    window.printReport = function() {
        window.print();
    };
});
</script>
<style>
.vulnerability-scan-log {
    border: 1px solid #333;
    border-radius: 4px;
    overflow: hidden;
}

.scan-log-title {
    background-color: #131313;
    color: var(--hacker-primary);
    padding: 0.5rem;
    font-weight: bold;
    border-bottom: 1px solid #333;
    font-size: 0.9rem;
}

.scan-log-content {
    background-color: #0c0c0c;
    padding: 0.5rem;
    font-family: var(--mono-font);
    font-size: 0.8rem;
    height: 150px;
    overflow-y: auto;
}

.scan-log-entry {
    margin-bottom: 0.25rem;
    line-height: 1.4;
    display: flex;
}

.scan-log-entry .time {
    color: #888;
    margin-right: 0.5rem;
    min-width: 70px;
}

.vulnerability-list {
    max-height: 600px;
    overflow-y: auto;
}

.vulnerability-item {
    border: 1px solid #333;
    border-radius: 4px;
    overflow: hidden;
}

.vulnerability-header {
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    font-weight: bold;
}

.severity-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 10px;
    background-color: rgba(255, 255, 255, 0.7);
}

.vuln-name {
    flex-grow: 1;
}

.vuln-severity {
    margin-right: 1rem;
    font-size: 0.8rem;
    padding: 0.1rem 0.4rem;
    border-radius: 3px;
    background-color: rgba(0, 0, 0, 0.2);
}

.vuln-cve {
    font-family: var(--mono-font);
    font-size: 0.8rem;
    font-weight: normal;
    padding: 0.1rem 0.4rem;
    border-radius: 3px;
    background-color: rgba(0, 0, 0, 0.2);
}

.vulnerability-details {
    padding: 0.75rem;
    background-color: #131313;
}

@media print {
    .navbar, .footer, form, .btn, .vulnerability-scan-log {
        display: none !important;
    }
    
    .card {
        break-inside: avoid;
        border: 1px solid #ddd !important;
    }
    
    .card-header {
        background-color: #f5f5f5 !important;
        color: #000 !important;
    }
    
    body {
        background-color: white !important;
        color: black !important;
    }
    
    .vulnerability-list {
        max-height: none;
        overflow: visible;
    }
}
</style>
{% endblock %}