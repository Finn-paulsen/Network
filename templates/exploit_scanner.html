{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card border-dark hacker-card mb-4">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">
                        <i class="fas fa-bug me-2"></i>Exploit Scanner
                    </h2>
                    <span class="badge bg-danger">Nur für Bildungszwecke</span>
                </div>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <div class="d-flex">
                        <div>
                            <i class="fas fa-exclamation-triangle fa-2x me-3 text-warning"></i>
                        </div>
                        <div>
                            <strong>Bildungszweck:</strong> Dieses Tool simuliert Schwachstellenscans zu Bildungszwecken.
                            Es werden keine tatsächlichen Angriffe durchgeführt, und alle Ergebnisse werden für das Verständnis
                            von Sicherheitsschwachstellen und deren Bewertung simuliert.
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-lg-4">
                        <div class="card border-dark">
                            <div class="card-header bg-dark text-white">
                                <h4 class="mb-0"><i class="fas fa-search me-2"></i>Scan-Parameter</h4>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('exploit_scanner') }}">
                                    {{ form.hidden_tag() }}
                                    
                                    <div class="mb-3">
                                        <label for="target_url" class="form-label">{{ form.target_url.label }}</label>
                                        {{ form.target_url(class="form-control", placeholder="z.B. example.com oder 192.168.1.1") }}
                                        <small class="form-text text-muted">Geben Sie eine URL oder IP für den simulierten Scan ein.</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="scan_type" class="form-label">{{ form.scan_type.label }}</label>
                                        {{ form.scan_type(class="form-select") }}
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="intensity" class="form-label">{{ form.intensity.label }}</label>
                                        {{ form.intensity(class="form-select") }}
                                        <small class="form-text text-muted">Bestimmt die Simulationstiefe.</small>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        {{ form.submit(class="btn btn-primary") }}
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card border-dark mt-3">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Scan-Typen</h5>
                            </div>
                            <div class="card-body">
                                <div class="scan-type-info">
                                    <h6>Basic Vulnerability Scan</h6>
                                    <p class="small">Identifiziert grundlegende Konfigurationsprobleme und häufige Sicherheitslücken.</p>
                                </div>
                                <div class="scan-type-info">
                                    <h6>Advanced Vulnerability Scan</h6>
                                    <p class="small">Tiefgehende Analyse für komplexere Schwachstellen und Fehlkonfigurationen.</p>
                                </div>
                                <div class="scan-type-info">
                                    <h6>DoS Vulnerability Check</h6>
                                    <p class="small">Sucht nach Anfälligkeiten für Denial-of-Service-Angriffe.</p>
                                </div>
                                <div class="scan-type-info">
                                    <h6>SQL Injection Test</h6>
                                    <p class="small">Prüft auf SQL-Injection-Schwachstellen in Webanwendungen.</p>
                                </div>
                                <div class="scan-type-info">
                                    <h6>XSS Vulnerability Test</h6>
                                    <p class="small">Sucht nach Cross-Site-Scripting-Schwachstellen.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        {% if result %}
                        <div class="card border-dark">
                            <div class="card-header bg-dark text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="mb-0"><i class="fas fa-clipboard-list me-2"></i>Scan-Ergebnisse</h4>
                                    <span class="text-muted small">{{ result.timestamp }}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                {% if result.status == 'error' %}
                                <div class="alert alert-danger">
                                    <i class="fas fa-exclamation-circle me-2"></i> {{ result.message }}
                                </div>
                                {% else %}
                                <div class="scan-overview mb-4">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-globe"></i></div>
                                                <div>
                                                    <div class="text-muted small">Ziel</div>
                                                    <div class="fw-bold">{{ result.target }}</div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-search"></i></div>
                                                <div>
                                                    <div class="text-muted small">Scan-Typ</div>
                                                    <div class="fw-bold">{{ result.scan_type }}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-tachometer-alt"></i></div>
                                                <div>
                                                    <div class="text-muted small">Intensität</div>
                                                    <div class="fw-bold">{{ result.intensity }}</div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="me-2"><i class="fas fa-clock"></i></div>
                                                <div>
                                                    <div class="text-muted small">Scan-Zeit</div>
                                                    <div class="fw-bold">{{ "%.2f"|format(result.scan_time) }} s</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Severity Summary -->
                                <div class="card border-dark mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Gefundene Schwachstellen</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-md-3">
                                                <div class="severity-count critical">
                                                    <div class="count">{{ result.severity_counts.critical }}</div>
                                                    <div class="label">Kritisch</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="severity-count high">
                                                    <div class="count">{{ result.severity_counts.high }}</div>
                                                    <div class="label">Hoch</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="severity-count medium">
                                                    <div class="count">{{ result.severity_counts.medium }}</div>
                                                    <div class="label">Mittel</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="severity-count low">
                                                    <div class="count">{{ result.severity_counts.low }}</div>
                                                    <div class="label">Niedrig</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="progress mt-3">
                                            <div class="progress-bar bg-danger" style="width: {{ (result.severity_counts.critical / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 }}%"></div>
                                            <div class="progress-bar bg-warning" style="width: {{ (result.severity_counts.high / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 }}%"></div>
                                            <div class="progress-bar bg-info" style="width: {{ (result.severity_counts.medium / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 }}%"></div>
                                            <div class="progress-bar bg-success" style="width: {{ (result.severity_counts.low / result.total_vulnerabilities * 100) if result.total_vulnerabilities > 0 else 0 }}%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Vulnerability List -->
                                <div class="card border-dark">
                                    <div class="card-header">
                                        <h5 class="mb-0">Detaillierte Ergebnisse</h5>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr>
                                                        <th>Schwachstelle</th>
                                                        <th>Schweregrad</th>
                                                        <th>CVE</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% if result.vulnerabilities %}
                                                        {% for vuln in result.vulnerabilities %}
                                                        <tr>
                                                            <td>{{ vuln.name }}</td>
                                                            <td>
                                                                <span class="badge bg-{{ 
                                                                    'danger' if vuln.severity == 'critical' else 
                                                                    'warning' if vuln.severity == 'high' else 
                                                                    'info' if vuln.severity == 'medium' else 
                                                                    'success' 
                                                                }}">{{ vuln.severity }}</span>
                                                            </td>
                                                            <td>{{ vuln.cve }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    {% else %}
                                                        <tr>
                                                            <td colspan="3" class="text-center">Keine Schwachstellen gefunden</td>
                                                        </tr>
                                                    {% endif %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% else %}
                        <div class="card border-dark h-100">
                            <div class="card-header bg-dark text-white">
                                <h4 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Informationen zu Schwachstellenscans</h4>
                            </div>
                            <div class="card-body">
                                <h5>Was ist ein Vulnerability Scanner?</h5>
                                <p>
                                    Vulnerability Scanner sind spezialisierte Tools, die automatisch nach Sicherheitslücken in 
                                    Netzwerken, Computersystemen oder Anwendungen suchen. Sie analysieren verschiedene Aspekte wie:
                                </p>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-laptop-code me-2"></i>Software-Schwachstellen
                                            </div>
                                            <div class="feature-card-content">
                                                Identifiziert veraltete Software, bekannte Sicherheitslücken und Patch-Status.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-cog me-2"></i>Fehlkonfigurationen
                                            </div>
                                            <div class="feature-card-content">
                                                Erkennt Fehlkonfigurationen in Servern, Firewalls oder Anwendungen.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-key me-2"></i>Authentifizierungsprobleme
                                            </div>
                                            <div class="feature-card-content">
                                                Prüft auf schwache Passwörter, unsichere Authentifizierungsmethoden oder Standardanmeldedaten.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="feature-card mb-3">
                                            <div class="feature-card-title">
                                                <i class="fas fa-code me-2"></i>Anwendungsschwachstellen
                                            </div>
                                            <div class="feature-card-content">
                                                Sucht nach Programmierfehlern wie SQL Injection, XSS, CSRF und Buffer Overflows.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info mt-3">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <strong>Hinweis:</strong> Dieses Tool ist eine <strong>Simulation</strong> und führt keine echten Schwachstellenscans durch.
                                    Es dient ausschließlich zu Bildungszwecken, um die Funktionsweise und Ergebnisdarstellung von
                                    Vulnerability Scannern zu verstehen.
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Scan type change handler
    const scanTypeSelect = document.getElementById('scan_type');
    const intensitySelect = document.getElementById('intensity');
    
    if (scanTypeSelect && intensitySelect) {
        scanTypeSelect.addEventListener('change', function() {
            if (this.value === 'advanced' || this.value === 'dos') {
                // For more complex scans, suggest higher intensity
                if (intensitySelect.value === 'low') {
                    intensitySelect.value = 'medium';
                }
            }
        });
    }
});
</script>
<style>
.scan-type-info {
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #333;
}

.scan-type-info:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.severity-count {
    padding: 1rem;
    border-radius: 4px;
    color: white;
}

.severity-count .count {
    font-size: 1.5rem;
    font-weight: bold;
}

.severity-count.critical {
    background-color: rgba(220, 53, 69, 0.2);
    color: #dc3545;
    border: 1px solid #dc3545;
}

.severity-count.high {
    background-color: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    border: 1px solid #ffc107;
}

.severity-count.medium {
    background-color: rgba(23, 162, 184, 0.2);
    color: #17a2b8;
    border: 1px solid #17a2b8;
}

.severity-count.low {
    background-color: rgba(40, 167, 69, 0.2);
    color: #28a745;
    border: 1px solid #28a745;
}

.feature-card {
    border: 1px solid #333;
    border-radius: 4px;
    overflow: hidden;
}

.feature-card-title {
    background-color: #0c0c0c;
    color: var(--hacker-primary);
    padding: 0.5rem;
    font-weight: bold;
}

.feature-card-content {
    background-color: #1a1a1a;
    padding: 0.75rem;
}
</style>
{% endblock %}